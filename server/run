#!/usr/bin/env bash
set -euo pipefail

# This script is executed by systemd on the server.
# It assumes the repo has been deployed to /srv/api/giftboard
# and that /srv/api/giftboard/current points to the active release.

cd "$(dirname "$0")/current"

entry="index.js"
if [ -f "server/index.js" ]; then
	entry="server/index.js"
fi

export NODE_ENV=${NODE_ENV:-production}
export PORT=${PORT:-6003}
export HOST=${HOST:-127.0.0.1}
export DATA_DIR=${DATA_DIR:-/srv/api/giftboard/data}
export UPLOAD_DIR=${UPLOAD_DIR:-/srv/api/giftboard/uploads}
export PATH=/usr/bin:/bin:$PATH

exec /usr/bin/node "$entry"